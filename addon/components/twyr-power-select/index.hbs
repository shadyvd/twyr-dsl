<BasicDropdown
	@destinationId={{@destinationId}}

	@matchTriggerWidth={{or @matchTriggerWidth false}}
	@preventScroll={{or @preventScroll false}}
	@renderInPlace={{or @renderInPlace false}}

	@xAlign={{or @xAlign "auto"}}
	@yAlign={{or @yAlign "auto"}}

	@onClose={{this.handleDropdownClose}}
	@onOpen={{this.handleDropdownOpen}}

	@calculatePosition={{@calculateDropdownPosition}}
	as |Dropdown|
>
	{{#with
		(hash
			Controls=(assign Dropdown.Controls this._selectControls)
			Options=this._selectOptions
			Status=(assign Dropdown.Status this._selectStatus)
		)
		as |PowerSelect|
	}}
		<Dropdown.Trigger
			class="twyr-power-select-trigger {{this.triggerClass}} {{if PowerSelect.Status.isActive "twyr-power-select-trigger--active"}}"
			role={{or @triggerRole "button"}}
			tabindex={{this.triggerTabindex}}

			@eventType={{or @eventType "mousedown"}}

			{{did-insert (fn this.didInsertTrigger Dropdown)}}
			{{did-mutate onMutate=this.didMutateTrigger}}
			{{did-update this.didReceiveArgsTrigger}}

			{{on "blur" this.handleBlur}}
			{{on "focus" this.handleFocus}}
			{{on "keydown" this.handleKeydownTrigger}}

			...attributes
		>
			{{#let (component (or @triggerComponent this.subComponents.triggerComponent)) as |Trigger|}}
				<Trigger
					@allowClear={{@allowClear}}
					@buildSelection={{@buildSelection}}
					@extra={{@extra}}
					@loadingMessage={{or @loadingMessage this.loadingMessage}}

					@placeholder={{@placeholder}}
					@placeholderComponent={{or @placeholderComponent this.subComponents.placeholderComponent}}

					@powerSelect={{PowerSelect}}

					@searchEnabled={{@searchEnabled}}
					@searchField={{@searchField}}

					@selectedItemComponent={{or @selectedItemComponent  this.subComponents.selectedItemComponent}}

					{{on "blur" this.handleBlur}}
					{{on "focus" this.handleFocus}}
					{{on "input" this.handleInput}}
					{{on "keydown" this.handleKeydownTriggerComponent}}

					as |Opt Term|
				>
				{{yield Opt Term}}
				</Trigger>
			{{/let}}
		</Dropdown.Trigger>

		<Dropdown.Content class="twyr-power-select-dropdown {{if PowerSelect.Status.isActive "twyr-power-select-dropdown--active"}} {{this.contentClass}}">
			{{#let (component (or @beforeOptionsComponent this.subComponents.beforeOptionsComponent)) as |BeforeOptions|}}
				<BeforeOptions
					@extra={{@extra}}

					@placeholder={{@placeholder}}
					@placeholderComponent={{or @placeholderComponent this.subComponents.placeholderComponent}}

					@powerSelect={{PowerSelect}}

					@searchEnabled={{@searchEnabled}}
					@searchPlaceholder={{@searchPlaceholder}}

					@selectedItemComponent={{or @selectedItemComponent this.subComponents.selectedItemComponent}}

					{{on "blur" this.handleBlur}}
					{{on "focus" this.handleFocus}}
					{{on "input" this.handleInput}}
					{{on "keydown" this.handleKeydownBeforeOptions}}
				/>
			{{/let}}

			{{#if this.mustShowSearchMessage}}
				{{#let (component (or @searchMessageComponent this.subComponents.searchMessageComponent)) as |SearchMessage|}}
					<SearchMessage
						@extra={{@extra}}
						@searchMessage={{this.searchMessage}}
						@powerSelect={{PowerSelect}}
					/>
				{{/let}}
			{{/if}}

			{{#if (and this.mustShowNoMatchesMessage this.noMatchesMessage)}}
				{{#let (component (or @noMatchesMessageComponent this.subComponents.noMatchesMessageComponent)) as |NoMatchesMessage|}}
					<NoMatchesMessage
						@extra={{@extra}}
						@noMatchesMessage={{this.noMatchesMessage}}
						@powerSelect={{PowerSelect}}
					/>
				{{/let}}
			{{/if}}

			{{#if (not (or this.mustShowSearchMessage this.mustShowNoMatchesMessage))}}
				{{#let (component (or @optionsComponent this.subComponents.optionsComponent)) as |Options|}}
					<Options
						class="twyr-power-select-options"
						@extra={{@extra}}
						@groupIndex=""
						@highlightOnHover={{this.highlightOnHover}}
						@loadingMessage={{or @loadingMessage this.loadingMessage}}

						@groupComponent={{or @groupComponent this.subComponents.groupComponent}}

						@powerSelect={{PowerSelect}}
						as |Option Select|
					>
						{{yield Option Select}}
					</Options>
				{{/let}}
			{{/if}}

			{{#let (component (or @afterOptionsComponent this.subComponents.afterOptionsComponent)) as |AfterOptions|}}
				<AfterOptions
					@extra={{@extra}}
					@powerSelect={{PowerSelect}}
				/>
			{{/let}}
		</Dropdown.Content>
	{{/with}}
</BasicDropdown>
